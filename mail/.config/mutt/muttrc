# vim: filetype=neomuttrc

# Cache settings for performance
set header_cache = "~/.cache/neomutt"
set message_cachedir = "~/.cache/neomutt/bodies"

# Mail check and timeout settings
set pager_index_lines = 10          
set pager_context = 3                # show 3 lines of context
set pager_stop                       # stop at end of message
set menu_scroll                      # scroll menu
set tilde                            # use ~ to pad mutt
set move=no                          # don't move messages when marking as read
set mail_check = 30                  # check for new mail every 30 seconds
set imap_keepalive = 900             # 15 minutes
set sleep_time = 0                   # don't sleep when idle
set wait_key = no		     # mutt won't ask "press key to continue"
set envelope_from                    # which from?
set edit_headers                     # show headers when composing
set fast_reply                       # skip to compose when replying
set askcc                            # ask for CC:
set fcc_attach                       # save attachments with the body
set forward_format = "Fwd: %s"       # format of subject when forwarding
set forward_decode                   # decode when forwarding
set forward_quote                    # include message in forwards
set mime_forward                     # forward attachments as part of body
set attribution = "On %d, %n wrote:" # format of quoting header
set reply_to                         # reply to Reply to: field
set reverse_name                     # reply as whomever it was to
set include                          # include message in replies
set text_flowed=yes                  # correct indentation for plain text
unset sig_dashes                     # no dashes before sig
unset markers

# Sort by newest conversation first.
set charset = "utf-8"
set uncollapse_jump
set sort_re
set sort = reverse-threads
set sort_aux = last-date-received
# How we reply and quote emails.
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set send_charset = "utf-8:iso-8859-1:us-ascii" # send in utf-8

# Mutt-wizard configuration
source /usr/share/mutt-wizard/mutt-wizard.muttrc
source /home/vaishnav/.config/mutt/accounts/forgamesonly684@gmail.com.muttrc

# Account switching macros
macro index,pager i1 '<sync-mailbox><enter-command>source /home/vaishnav/.config/mutt/accounts/forgamesonly684@gmail.com.muttrc<enter><change-folder>!<enter>;<check-stats>' "switch to forgamesonly684@gmail.com"
macro index,pager i2 '<sync-mailbox><enter-command>source /home/vaishnav/.config/mutt/accounts/write2vaichu@gmail.com.muttrc<enter><change-folder>!<enter>;<check-stats>' "switch to write2vaichu@gmail.com"

# Compose macros
macro compose M "F pandoc -s -f markdown -t html \ny^T^Utext/html; charset=utf-8\nn" "Convert MD to HTML"

# Manual sync macro (optional)
macro index,pager O '<shell-escape>mbsync -a<enter>' "sync all mail"

# Scan for URL's
macro index,pager \cb "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"

# Searching
macro index S "<shell-escape>mbsync -a<enter><shell-escape>notmuch new<enter>" "sync email"
macro index \Cf "<enter-command>unset wait_key<enter><shell-escape>read -p 'Enter a search term to find with notmuch: ' x; echo \$x >~/.cache/mutt_terms<enter><limit>~i \"\`notmuch search --output=messages \$(cat ~/.cache/mutt_terms) | head -n 600 | perl -le '@a=<>;s/\^id:// for@a;$,=\"|\";print@a' | perl -le '@a=<>; chomp@a; s/\\+/\\\\+/ for@a;print@a' \`\"<enter>" "show only messages matching a notmuch pattern"
macro index,pager i3 '<sync-mailbox><enter-command>source /home/vaishnav/.config/mutt/accounts/vaishnav.sabari.girish@gmail.com.muttrc<enter><change-folder>!<enter>;<check-stats>' "switch to vaishnav.sabari.girish@gmail.com"
